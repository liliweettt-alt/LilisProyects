<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Archive | Script Repository V3</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&family=Space+Mono:ital,wght@0,400;0,700;1,400&display=swap');
        
        body { 
            background-color: #0f1115; color: #e2e8f0; 
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
        }
        h1, h2, h3, .cinzel { font-family: 'Cinzel', serif; }
        .font-mono { font-family: 'Space Mono', monospace; }
        
        /* App-like Field Groups (Like the screenshots) */
        .field-group {
            background-color: #1e222b;
            border-radius: 0.75rem;
            border: 1px solid #2d3340;
            overflow: hidden;
            margin-bottom: 1.5rem;
        }
        .field-row {
            padding: 0.75rem 1rem;
            border-bottom: 1px solid #2d3340;
            display: flex;
            flex-direction: column;
        }
        .field-row:last-child { border-bottom: none; }
        .field-row label {
            font-size: 0.75rem;
            color: #94a3b8;
            margin-bottom: 0.25rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }
        .field-row input, .field-row textarea {
            background: transparent;
            color: #f8fafc;
            border: none;
            outline: none;
            font-size: 1rem;
            width: 100%;
        }
        .field-row textarea { min-height: 80px; resize: vertical; }
        .field-row input::placeholder, .field-row textarea::placeholder { color: #475569; }

        /* Buttons & Badges */
        .btn { 
            padding: 0.5rem 1rem; border-radius: 0.5rem; font-weight: 600; 
            cursor: pointer; transition: all 0.2s; font-size: 0.875rem;
            display: inline-flex; items-center; justify-content: center;
        }
        .btn-primary { background-color: #3b82f6; color: white; }
        .btn-primary:hover { background-color: #2563eb; }
        .btn-secondary { background-color: #2d3340; color: #e2e8f0; border: 1px solid #475569; }
        .btn-secondary:hover { background-color: #334155; }
        
        /* Tab Navigation */
        .tab-scroll { display: flex; overflow-x: auto; gap: 1rem; padding-bottom: 0.5rem; border-bottom: 1px solid #2d3340; margin-bottom: 1.5rem; }
        .tab-btn {
            padding: 0.5rem 0; border-bottom: 2px solid transparent; 
            color: #64748b; font-weight: 600; font-size: 0.95rem;
            white-space: nowrap; transition: all 0.2s; cursor: pointer;
        }
        .tab-btn.active { color: #f8fafc; border-bottom-color: #3b82f6; }
        
        .tab-content { display: none; animation: fadeIn 0.2s ease-in-out; }
        .tab-content.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }
        
        .hidden-view { display: none !important; }

        /* Read View Formatting */
        .read-section { margin-bottom: 2rem; }
        .read-section h4 { color: #3b82f6; font-size: 0.85rem; text-transform: uppercase; letter-spacing: 0.1em; margin-bottom: 0.5rem; font-weight: bold; border-bottom: 1px solid #2d3340; padding-bottom: 0.25rem;}
        .read-data { margin-bottom: 1rem; }
        .read-label { font-size: 0.75rem; color: #64748b; text-transform: uppercase; }
        .read-value { font-size: 1.05rem; color: #f8fafc; white-space: pre-wrap; }
    </style>
</head>
<body class="p-4 md:p-8 max-w-4xl mx-auto min-h-screen flex flex-col">

    <header class="mb-8 border-b border-[#2d3340] pb-4 flex justify-between items-end">
        <div>
            <h1 class="text-3xl font-bold cinzel text-white">The Archive</h1>
            <p class="text-[#64748b] text-xs font-mono mt-1">Version 3.0 // Granular Databanks</p>
        </div>
        <div class="flex gap-2">
            <button onclick="openEditor()" class="btn btn-primary">+ New Script</button>
        </div>
    </header>

    <main id="view-dashboard" class="flex-grow">
        <div id="itemList" class="grid grid-cols-1 md:grid-cols-2 gap-4">
            </div>
    </main>

    <main id="view-read" class="flex-grow hidden-view bg-[#14171c] p-6 rounded-xl border border-[#2d3340]">
        <div class="flex justify-between items-start mb-6 pb-4 border-b border-[#2d3340]">
            <div>
                <button onclick="closeToDashboard()" class="text-[#64748b] hover:text-white text-sm mb-2">‚Üê Back to Library</button>
                <h2 id="read-title" class="text-3xl font-bold text-white cinzel">Script Title</h2>
                <p id="read-universe" class="text-[#3b82f6] text-sm mt-1">Universe Name</p>
            </div>
            <button onclick="editCurrentRead()" class="btn btn-secondary text-xs">Edit Script</button>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
            <div>
                <div class="read-section">
                    <h4>The Avatar</h4>
                    <div class="read-data"><div class="read-label">DR Name</div><div id="read-avatar-name" class="read-value"></div></div>
                    <div class="read-data"><div class="read-label">Age & Details</div><div id="read-avatar-age" class="read-value"></div></div>
                    <div class="read-data"><div class="read-label">Appearance</div><div id="read-avatar-looks" class="read-value text-sm"></div></div>
                </div>

                <div class="read-section">
                    <h4>The Code (Rules)</h4>
                    <div class="read-data"><div class="read-label">Safeword</div><div id="read-code-safeword" class="read-value text-red-400 font-mono"></div></div>
                    <div class="read-data"><div class="read-label">Time Ratio</div><div id="read-code-time" class="read-value"></div></div>
                    <div class="read-data"><div class="read-label">Safety & Conditions</div><div id="read-code-rules" class="read-value text-sm"></div></div>
                </div>
            </div>
            
            <div>
                <div class="read-section">
                    <h4>The Blueprint (World)</h4>
                    <div class="read-data"><div class="read-label">Starting Location</div><div id="read-world-location" class="read-value"></div></div>
                    <div class="read-data"><div class="read-label">Current Era / Year</div><div id="read-world-era" class="read-value"></div></div>
                    <div class="read-data"><div class="read-label">World Notes & Lore</div><div id="read-world-lore" class="read-value text-sm"></div></div>
                </div>

                <div class="read-section">
                    <h4>The Roster</h4>
                    <div class="read-data"><div class="read-label">Relationships & Connections</div><div id="read-roster-notes" class="read-value text-sm"></div></div>
                </div>
            </div>
        </div>
    </main>

    <main id="view-editor" class="flex-grow hidden-view">
        <div class="flex justify-between items-center mb-6">
            <h2 class="text-xl font-bold text-white" id="editorTitle">Edit Entry</h2>
            <div class="space-x-2">
                <button onclick="closeEditor()" class="btn btn-secondary">Cancel</button>
                <button onclick="saveRecord()" class="btn btn-primary">Save Changes</button>
            </div>
        </div>

        <div class="field-group">
            <div class="field-row">
                <label>Script Title (e.g., Hogwarts Year 4)</label>
                <input type="text" id="inpTitle" placeholder="My Desired Reality...">
            </div>
            <div class="field-row">
                <label>Destination Universe / Fandom</label>
                <input type="text" id="inpUniverse" placeholder="Harry Potter, MCU, etc...">
            </div>
        </div>

        <div class="tab-scroll">
            <button onclick="switchTab('tab-avatar')" id="btn-avatar" class="tab-btn active">Avatar</button>
            <button onclick="switchTab('tab-world')" id="btn-world" class="tab-btn">World</button>
            <button onclick="switchTab('tab-rules')" id="btn-rules" class="tab-btn">Rules</button>
            <button onclick="switchTab('tab-roster')" id="btn-roster" class="tab-btn">Roster</button>
        </div>

        <div id="tab-avatar" class="tab-content active">
            <div class="field-group">
                <div class="field-row">
                    <label>DR Name</label>
                    <input type="text" id="inpAvatarName" placeholder="First and Last name">
                </div>
                <div class="field-row">
                    <label>Age / Birthday</label>
                    <input type="text" id="inpAvatarAge" placeholder="16 years old...">
                </div>
                <div class="field-row">
                    <label>Physical Appearance</label>
                    <textarea id="inpAvatarLooks" placeholder="Eye color, hair, style, exact height..."></textarea>
                </div>
            </div>
        </div>

        <div id="tab-world" class="tab-content">
            <div class="field-group">
                <div class="field-row">
                    <label>Arrival Location</label>
                    <input type="text" id="inpWorldLoc" placeholder="Where do you wake up?">
                </div>
                <div class="field-row">
                    <label>Era / Year</label>
                    <input type="text" id="inpWorldEra" placeholder="e.g., September 1st, 1994">
                </div>
                <div class="field-row">
                    <label>World Rules & Lore</label>
                    <textarea id="inpWorldLore" placeholder="How does magic work? Any canon divergences?"></textarea>
                </div>
            </div>
        </div>

        <div id="tab-rules" class="tab-content">
            <div class="field-group">
                <div class="field-row">
                    <label>Safeword / Return Action</label>
                    <input type="text" id="inpRulesSafe" placeholder="e.g., 'Jumanji' or clapping 3 times">
                </div>
                <div class="field-row">
                    <label>Time Ratio</label>
                    <input type="text" id="inpRulesTime" placeholder="1 hour in CR = 1 week in DR">
                </div>
                <div class="field-row">
                    <label>Safety & Immunities</label>
                    <textarea id="inpRulesImmune" placeholder="I cannot feel extreme pain. I cannot permanently die..."></textarea>
                </div>
            </div>
        </div>

        <div id="tab-roster" class="tab-content">
            <div class="field-group">
                <div class="field-row">
                    <label>Relationships</label>
                    <textarea id="inpRosterNotes" placeholder="List friends, family, enemies, and your relationship dynamics..." style="min-height: 150px;"></textarea>
                </div>
            </div>
        </div>
        
        <div class="mt-4 text-right border-t border-[#2d3340] pt-4">
            <button id="btnDelete" onclick="deleteCurrentRecord()" class="text-red-500 hover:text-red-400 text-sm hidden">Delete Entire Script</button>
        </div>
    </main>

    <script>
        let appData = [];
        const STORAGE_KEY = 'archive_dr_scripts_v3';
        let currentViewingId = null;

        document.addEventListener('DOMContentLoaded', () => {
            const stored = localStorage.getItem(STORAGE_KEY);
            if (stored) {
                try { appData = JSON.parse(stored); } 
                catch(e) { appData = []; }
            }
            renderDashboard();
        });

        function saveData() { 
            localStorage.setItem(STORAGE_KEY, JSON.stringify(appData)); 
            renderDashboard(); 
        }

        // --- VIEW MANAGEMENT ---
        function showView(viewId) {
            document.getElementById('view-dashboard').classList.add('hidden-view');
            document.getElementById('view-read').classList.add('hidden-view');
            document.getElementById('view-editor').classList.add('hidden-view');
            document.getElementById(viewId).classList.remove('hidden-view');
        }

        // --- DASHBOARD ---
        function renderDashboard() {
            const listContainer = document.getElementById('itemList');
            listContainer.innerHTML = '';
            
            if (appData.length === 0) {
                listContainer.innerHTML = '<div class="col-span-1 md:col-span-2 text-center p-8 bg-[#1e222b] rounded-xl text-[#64748b] border border-[#2d3340]">No scripts found. Create your first one above!</div>';
                return;
            }

            appData.forEach(item => {
                const div = document.createElement('div');
                div.className = 'bg-[#1e222b] p-5 rounded-xl border border-[#2d3340] cursor-pointer hover:border-[#3b82f6] transition-colors';
                div.onclick = () => openReadView(item.id); 
                div.innerHTML = `
                    <h3 class="font-bold text-lg text-white cinzel">${item.title}</h3>
                    <p class="text-[#3b82f6] text-xs uppercase tracking-wider mb-2">${item.universe || 'Unknown Universe'}</p>
                    <p class="text-[#94a3b8] text-sm line-clamp-2">${item.world_lore || 'No world lore added yet...'}</p>
                `;
                listContainer.appendChild(div);
            });
            showView('view-dashboard');
        }

        // --- READ VIEW ---
        function openReadView(id) {
            currentViewingId = id;
            const script = appData.find(s => s.id === id);
            
            document.getElementById('read-title').innerText = script.title || 'Untitled';
            document.getElementById('read-universe').innerText = script.universe || 'Unspecified Universe';
            
            // Populate Read Fields
            document.getElementById('read-avatar-name').innerText = script.avatar_name || '--';
            document.getElementById('read-avatar-age').innerText = script.avatar_age || '--';
            document.getElementById('read-avatar-looks').innerText = script.avatar_looks || '--';
            
            document.getElementById('read-code-safeword').innerText = script.rules_safe || '--';
            document.getElementById('read-code-time').innerText = script.rules_time || '--';
            document.getElementById('read-code-rules').innerText = script.rules_immune || '--';

            document.getElementById('read-world-location').innerText = script.world_loc || '--';
            document.getElementById('read-world-era').innerText = script.world_era || '--';
            document.getElementById('read-world-lore').innerText = script.world_lore || '--';

            document.getElementById('read-roster-notes').innerText = script.roster_notes || '--';

            showView('view-read');
        }

        function closeToDashboard() {
            currentViewingId = null;
            renderDashboard();
        }

        // --- EDITOR VIEW ---
        function openEditor(id = null) {
            switchTab('tab-avatar'); // Default tab
            
            if (id) {
                // Editing existing
                const script = appData.find(s => s.id === id);
                document.getElementById('editorTitle').innerText = "Edit Script";
                document.getElementById('btnDelete').classList.remove('hidden');
                
                // Populate Inputs
                document.getElementById('inpTitle').value = script.title || '';
                document.getElementById('inpUniverse').value = script.universe || '';
                
                document.getElementById('inpAvatarName').value = script.avatar_name || '';
                document.getElementById('inpAvatarAge').value = script.avatar_age || '';
                document.getElementById('inpAvatarLooks').value = script.avatar_looks || '';

                document.getElementById('inpWorldLoc').value = script.world_loc || '';
                document.getElementById('inpWorldEra').value = script.world_era || '';
                document.getElementById('inpWorldLore').value = script.world_lore || '';

                document.getElementById('inpRulesSafe').value = script.rules_safe || '';
                document.getElementById('inpRulesTime').value = script.rules_time || '';
                document.getElementById('inpRulesImmune').value = script.rules_immune || '';

                document.getElementById('inpRosterNotes').value = script.roster_notes || '';
            } else {
                // New Script
                currentViewingId = null;
                document.getElementById('editorTitle').innerText = "New Script";
                document.getElementById('btnDelete').classList.add('hidden');
                
                // Clear all inputs
                document.querySelectorAll('input, textarea').forEach(el => el.value = '');
            }
            showView('view-editor');
        }

        function editCurrentRead() {
            openEditor(currentViewingId);
        }

        function closeEditor() {
            if (currentViewingId) {
                openReadView(currentViewingId); // Go back to reading if we were editing
            } else {
                renderDashboard(); // Go back to dash if we cancelled a new script
            }
        }

        function saveRecord() {
            const title = document.getElementById('inpTitle').value;
            if(!title) { alert("Script Title is required."); return; }

            const scriptData = {
                title: title,
                universe: document.getElementById('inpUniverse').value,
                
                avatar_name: document.getElementById('inpAvatarName').value,
                avatar_age: document.getElementById('inpAvatarAge').value,
                avatar_looks: document.getElementById('inpAvatarLooks').value,

                world_loc: document.getElementById('inpWorldLoc').value,
                world_era: document.getElementById('inpWorldEra').value,
                world_lore: document.getElementById('inpWorldLore').value,

                rules_safe: document.getElementById('inpRulesSafe').value,
                rules_time: document.getElementById('inpRulesTime').value,
                rules_immune: document.getElementById('inpRulesImmune').value,

                roster_notes: document.getElementById('inpRosterNotes').value,
                
                lastEdited: new Date().toISOString()
            };

            if (currentViewingId) {
                // Update existing
                const index = appData.findIndex(s => s.id === currentViewingId);
                if(index !== -1) { appData[index] = { ...appData[index], ...scriptData }; }
            } else {
                // Create new
                scriptData.id = crypto.randomUUID();
                appData.unshift(scriptData);
                currentViewingId = scriptData.id; // Set id so it opens in read view after save
            }

            saveData();
            openReadView(currentViewingId); // Bring them to the read view of what they just saved
        }

        function deleteCurrentRecord() {
            if(confirm("Are you sure you want to delete this script forever?")) {
                appData = appData.filter(item => item.id !== currentViewingId);
                currentViewingId = null;
                saveData();
            }
        }

        // --- TAB LOGIC ---
        function switchTab(tabId) {
            document.querySelectorAll('.tab-content').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            document.getElementById(tabId).classList.add('active');
            document.getElementById(`btn-${tabId.split('-')[1]}`).classList.add('active');
        }
    </script>
</body>
</html>
